<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Report Address | NoTippers</title>
  <style>
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:#f8f9fa; color:#333; display:flex; flex-direction:column; min-height:100vh; }
    header { background:#0d6efd; color:#fff; padding:12px 20px; font-size:20px; font-weight:bold; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    header .logo { font-weight: bold; }
    header nav { display:flex; gap:16px; flex-wrap:wrap; }
    header nav a { color:#fff; text-decoration:none; font-size:14px; background:rgba(255,255,255,.15); padding:6px 10px; border-radius:6px; }
    header nav a:hover { background:rgba(255,255,255,.3); }
    main { flex:1; max-width:640px; margin:0 auto; padding:20px; }
    h1 { color:#0d6efd; margin:0 0 10px; text-align:center }
    .notice { background:#e7f1ff; border:1px solid #b6d4fe; padding:10px; border-radius:8px; font-size:14px; margin-bottom:16px; }
    form { background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,.1); }
    label { display:block; margin-bottom:6px; font-weight:600; }
    input, select, textarea { width:100%; padding:10px; margin-bottom:16px; border:1px solid #ccc; border-radius:6px; font-size:16px; }
    textarea { resize:vertical; min-height:80px; }
    .row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .type, .platforms { display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:10px; margin:8px 0 16px; }
    .checkbox { display:flex; align-items:center; gap:8px; font-size:14px; }
    .actions { display:flex; gap:12px; flex-wrap:wrap; }
    button { background:#0d6efd; color:#fff; border:0; padding:12px 16px; border-radius:8px; font-weight:700; cursor:pointer; }
    button:hover { background:#0b5ed7; }
    .secondary { background:#e9ecef; color:#333; }
    .alert { display:none; padding:10px; border-radius:8px; margin:12px 0; font-size:14px; }
    .ok { background:rgba(81,207,102,.12); border:1px solid rgba(81,207,102,.35); color:#1b5e20; }
    .err { background:rgba(255,107,107,.12); border:1px solid rgba(255,107,107,.35); color:#7a0000; }
    footer { background:#f1f3f5; text-align:center; padding:12px; font-size:14px; color:#555; }
    @media (max-width:680px){ .row { grid-template-columns:1fr; } }
  </style>
</head>
<body>
  <header>
    <div class="logo">NoTippers</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="learn-more.html">Learn More</a>
      <a href="signup.html">Sign Up</a>
      <a href="report.html">Report Address</a>
    </nav>
  </header>

  <main>
    <h1>Report a Non-Tipper / Bait-Tipper</h1>
    <p class="notice">
      Your identity remains <strong>100% anonymous</strong>. Please share accurate info only.
      No names — <strong>addresses only</strong> plus any helpful context (platform, notes, etc.).
    </p>

    <div id="ok" class="alert ok">Thanks — your report was recorded.</div>
    <div id="err" class="alert err">Sorry, something went wrong. Please try again.</div>

    <form id="reportForm" novalidate>
      <label for="address_line1">Address Line 1</label>
      <input id="address_line1" name="address_line1" required placeholder="123 Main St">

      <label for="address_line2">Address Line 2 (optional)</label>
      <input id="address_line2" name="address_line2" placeholder="Apt 4B">

      <div class="row">
        <div>
          <label for="city">City</label>
          <input id="city" name="city" required>
        </div>
        <div>
          <label for="state">State</label>
          <select id="state" name="state" required>
            <option value="">Select</option>
            <option>AL</option><option>AK</option><option>AZ</option><option>AR</option>
            <option>CA</option><option>CO</option><option>CT</option><option>DE</option>
            <option>FL</option><option>GA</option><option>HI</option><option>ID</option>
            <option>IL</option><option>IN</option><option>IA</option><option>KS</option>
            <option>KY</option><option>LA</option><option>ME</option><option>MD</option>
            <option>MA</option><option>MI</option><option>MN</option><option>MS</option>
            <option>MO</option><option>MT</option><option>NE</option><option>NV</option>
            <option>NH</option><option>NJ</option><option>NM</option><option>NY</option>
            <option>NC</option><option>ND</option><option>OH</option><option>OK</option>
            <option>OR</option><option>PA</option><option>RI</option><option>SC</option>
            <option>SD</option><option>TN</option><option>TX</option><option>UT</option>
            <option>VT</option><option>VA</option><option>WA</option><option>WV</option>
            <option>WI</option><option>WY</option>
          </select>
        </div>
      </div>

      <label for="zip">ZIP (optional)</label>
      <input id="zip" name="zip" inputmode="numeric" pattern="[0-9]{5}(-[0-9]{4})?">

      <label>Type</label>
      <div class="type">
        <label class="checkbox"><input type="radio" name="type" value="non_tipper" required> Non-Tipper</label>
        <label class="checkbox"><input type="radio" name="type" value="bait_tipper" required> Bait-Tipper</label>
      </div>

      <label>Delivery Platforms (choose any)</label>
      <div class="platforms">
        <label class="checkbox"><input type="checkbox" name="platforms" value="DoorDash"> DoorDash</label>
        <label class="checkbox"><input type="checkbox" name="platforms" value="Uber"> Uber</label>
        <label class="checkbox"><input type="checkbox" name="platforms" value="Lyft"> Lyft</label>
        <label class="checkbox"><input type="checkbox" name="platforms" value="Instacart"> Instacart</label>
        <label class="checkbox"><input type="checkbox" name="platforms" value="Shipt"> Shipt</label>
        <label class="checkbox"><input type="checkbox" name="platforms" value="Grubhub"> Grubhub</label>
        <label class="checkbox"><input type="checkbox" name="platforms" value="Other"> Other</label>
      </div>

      <label for="story_url">Story / Video URL (optional)</label>
      <input id="story_url" name="story_url" type="url" placeholder="https://...">

      <label for="notes">Notes (what happened?)</label>
      <textarea id="notes" name="notes" rows="4" placeholder="Keep it factual. No names."></textarea>

      <!-- Honeypot -->
      <input type="text" name="_gotcha" style="display:none">
      <!-- Client-side rate limit -->
      <input type="hidden" id="lastSubmitTs" value="">

      <div class="actions">
        <button type="submit">Submit Report</button>
        <button type="reset" class="secondary">Clear</button>
      </div>
    </form>
  </main>

  <footer>© <span id="y"></span> NoTippers</footer>

  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    const SUPABASE_URL = "https://sruwewdifhinkviqibjv.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNydXdld2RpZmhpbmt2aXFpYmp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUyMTM1NzIsImV4cCI6MjA3MDc4OTU3Mn0.p2UHsx4ejit75hoBKt7XeoaQIL6NEhzNDv-N0IBib-s";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const ok = document.getElementById('ok');
    const err = document.getElementById('err');
    const form = document.getElementById('reportForm');

    function show(el){ el.style.display='block'; }
    function hide(el){ el.style.display='none'; }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      hide(ok); hide(err);

      // simple client-side rate limit: 15s between submissions
      const now = Date.now();
      const last = Number(localStorage.getItem('report_last_submit') || 0);
      if (now - last < 15000) {
        err.textContent = "Please wait a few seconds before submitting again.";
        show(err); return;
      }

      const address_line1 = form.address_line1.value.trim();
      const city = form.city.value.trim();
      const state = form.state.value.trim();
      const type = (new FormData(form)).get('type');
      if (!address_line1 || !city || !state || !type) {
        err.textContent = "Please fill in Address, City, State, and Type.";
        show(err); return;
      }

      const platforms = Array.from(document.querySelectorAll('input[name="platforms"]:checked')).map(cb => cb.value);

      const payload = {
        address_line1,
        address_line2: form.address_line2.value.trim() || null,
        city,
        state,
        zip: form.zip.value.trim() || null,
        type,
        platforms,
        notes: form.notes.value.trim() || null,
        story_url: form.story_url.value.trim() || null
      };

      try {
        const { error } = await supabase.from('reports').insert(payload);
        if (error) throw error;

        localStorage.setItem('report_last_submit', String(now));
        // Optional inline success + scroll, but we’ll redirect for a clean UX:
        // show(ok); window.scrollTo({top:0, behavior:'smooth'});
        window.location.href = "thank-you.html";
      } catch (e) {
        err.textContent = "Error: " + (e.message || "unable to submit");
        show(err);
      }
    });
  </script>
</body>
</html>